[ui]
username = David Shepherd <david.shepherd@biositesystems.com>
ignore = ~/.hgignore
editor = emacsclient -c
merge = emacsclient

[pager]
pager = less -F -R -X -S
attend=
ignore=crecord,histedit,he,revert,pull,push,commit,update,up,rebase,mv,rm,ungulp,record,merge

[extensions]
pager =
progress =
color =
purge =
shelve =
graphlog =
record =
histedit =
crecord = ~/.hgex/crecord/crecord
remotebranches = ~/.hgex/remotebranches/hg_remotebranches.py
rebase =
strip =
transplant =

[color]

custom.tag = yellow bold
custom.bookmark = yellow
custom.author = blue bold
custom.time = green

changeset.public=red
changeset.secret=blue
changeset.draft=green

[revsetalias]

this_branch_simple($1) = reverse(ancestors($1)) - (keyword(chore) and keyword(gulp)) - keyword(merge)

# Get the last branching commit (i.e. last commit with multiple descendents)
prev_branchpoint($1) = last(ancestors($1) and branchpoint())

# Get the commit after the last branch (i.e. what you rebase from if you do rebase -b $1).
base($1) = last(limit(reverse(last(prev_branchpoint($1)::$1)),2))

anc($1) = reverse(ancestors($1))

[merge-tools]
emacsclient.premerge = True
emacsclient.args = -c --eval "(emerge-files-with-ancestor nil \""$local"\" \""$other"\" \""$base"\" \""$output"\" nil #'delete-frame)"
# I don't know what's going on with the quoting on the line above, but it seems to be necessary

[alias]

# Biosite stuff
#########

# Interact with RhodeCode
push-review = push -f review
pr = !$HG push-review "$@"; pa-pull-request.sh

ccommon = commit -m "chore(common): Update common" 'path:common'

# General stuff
##############

# pretty log graph
lg = !$HG log --color=always -G --template "{if(tags, label('custom.tag','[ {tags} ] '))}{if(bookmarks, label('custom.bookmark','[ {bookmarks} ] '))}{label('changeset.{phase}', node|short)} {desc|firstline} {label('custom.time',date|age)} {label('custom.author',author|person)}" "$@" | sed -e '1i\\' 2>/dev/null | less -FRXS

lp = log -p --color=always -r 'this_branch_simple(.)'
lgs = log --color=always -G --template "{if(tags, label('custom.tag','[ {tags} ] '))}{if(bookmarks, label('custom.bookmark','[ {bookmarks} ] '))}{label('changeset.{phase}', node|short)} {desc|firstline} {label('custom.time',date|age)} {label('custom.author',author|person)}" -r 'this_branch_simple(.)'

# status including subrepos and with path relative to cwd
s = !$HG status -S "" --color=always "$@" -n | sed -e '1i\\' 2>/dev/null | less -FRXS
st = !$HG status -S "" --color=always "$@" -n | less -FRXS

# st with numberwang selection
stnw = !$HG status --no-status --color=always -S $($HG root) "$@" | nwc

# View shelved changesets
shs = !$HG shelve --list --patch $@ --color=always | less -FRXS

# Manifest with better xargs integration
manifest0 = !$HG manifest | tr '\n' '\0'

# Side by side diff
sdiff = !$HG diff $@ | cdiff -s

# "undo" commiting.
doagain = !hg-do-again.sh

# Get the real hash of a revision (as needed for hgsubstate)
idfull = !$HG --debug id -i "$@"


# Clean up whitespace, warning: not well tested yet, potentially dangerous
clean-ws = !hg-clean-whitespace.sh

# Single command bisection
autobisect = !$HG status && $HG bisect --reset && $HG bisect --good "$1" && $HG bisect --bad "$2" && $HG bisect --command "$3"

# histedit with default revision the earliest multable revision on this branch
he = histedit -r 'min(draft() and only(.))'

backout-commit = !$HG backout -r "$1" && $HG commit -m "Backed out $1"

multi-backout = !$HG log -r "$1" -T "{node}\n" | xargs -n1 $HG backout-commit

cmerge = commit -m "Merge"
