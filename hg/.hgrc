[ui]
username = David Shepherd <david.shepherd@biositesystems.com>
ignore = ~/.hgignore
editor = emacsclient -c

[pager]
pager = less -F -R -X -S

[extensions]
pager =
progress =
color =
purge =
shelve =
graphlog =
record =
histedit =
crecord = ~/.hgex/crecord/
rebase =
strip =
transplant =

[color]

custom.tag = yellow bold
custom.bookmark = yellow
custom.author = blue bold
custom.time = green

changeset.public=red
changeset.secret=blue
changeset.draft=green

[revsetalias]

this_branch_simple($1) = reverse(ancestors($1)) - (keyword(chore) and keyword(gulp)) - keyword(merge)

# Get the last branching commit (i.e. last commit with multiple descendents)
prev_branchpoint($1) = last(ancestors($1) and branchpoint())

# Get the commit after the last branch (i.e. what you rebase from if you do rebase -b $1).
base($1) = last(limit(reverse(last(prev_branchpoint($1)::$1)),2))


[alias]

# Biosite stuff
#########

# Interact with RhodeCode
push-review = push -f review
pr = !$HG push-review "$@"; pa-pull-request.sh

ccommon = commit -m "chore(common): Update common" 'path:common'

# General stuff
##############

# pretty log graph
lg = !$HG log --color=always -G --template "{if(tags, label('custom.tag','[{tags}] '))}{if(bookmarks, label('custom.bookmark','[{bookmarks}] '))}{label('changeset.{phase}', node|short)} {desc|firstline} {label('custom.time',date|age)} {label('custom.author',author|person)}" "$@" | sed -e '1i\\' 2>/dev/null | less -FRXS

lp = !$HG log -p --color=always -r 'this_branch_simple(.)' "$@" | less -FRXS
lgs = !$HG lg -r 'this_branch_simple(.)' "$@"

# status including subrepos and with path relative to root
s = !$HG status -S $($HG root) --color=always "$@" | sed -e '1i\\' 2>/dev/null | less -FRXS
st = !$HG status -S $($HG root) --color=always "$@"

# st with numberwang selection
stnw = !$HG status --no-status --color=always -S $($HG root) "$@" | nwc

# View shelved changesets
shs = !$HG shelve --list --patch $@ --color=always | less -FRXS

# Manifest with better xargs integration
manifest0 = !$HG manifest | tr '\n' '\0'

# Side by side diff
sdiff = !$HG diff $@ | cdiff -s

# "undo" commiting.
doagain = !hg-do-again.sh

# Get the real hash of a revision (as needed for hgsubstate)
idfull = !$HG --debug id -i "$@"


# Clean up whitespace, warning: not well tested yet, potentially dangerous
clean-ws = !hg-clean-whitespace.sh

# Single command bisection
autobisect = !$HG status && $HG bisect --reset && $HG bisect --good "$1" && $HG bisect --bad "$2" && $HG bisect --command "$3"

# histedit with default revision the earliest multable revision on this branch
he = histedit -r 'min(draft() and ancestors(.))'
